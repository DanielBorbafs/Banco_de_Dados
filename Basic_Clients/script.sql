/* REGRAS SOBRE FK A SEREM SEGUIDAS,
 - Em relacionamentos 1x1 a chave estrangeira fica na tabela mais fraca 
 - em relacionamento 1xN a chave estrangeira ficara sempre na cardinalidade N */

CREATE TABLE CLIENTE (
	IDCLIENTE INT PRIMARY KEY AUTO_INCREMENT,
	NOME VARCHAR(30) NOT NULL,
	SEXO ENUM('M', 'F') NOT NULL,
	EMAIL VARCHAR(50) UNIQUE,
	CPF	VARCHAR(15) UNIQUE
);


CREATE TABLE ENDERECO( 
	IDENDERECO INT PRIMARY KEY AUTO_INCREMENT,
	RUA VARCHAR(30) NOT NULL,
	BAIRRO VARCHAR(30) NOT NULL,
	CIDADE VARCHAR(30) NOT NULL,
	ESTADO CHAR(2) NOT NULL
	ID_CLIENTE INT UNIQUE,
	FOREIGN KEY (ID_CLIENTE)
	REFERENCES CLIENTE(IDCLIENTE)
); 



CREATE TABLE TELEFONE(
	IDTELEFONE INT PRIMARY KEY AUTO_INCREMENT,
	TIPO ENUM('RES', 'COM', 'CEL') NOT NULL,
	NUMERO VARCHAR(10) NOT NULL
	ID_CLIENTE INT,
	FOREIGN KEY(ID_CLIENTE)
	REFERENCES CLIENTE(IDCLIENTE)
);


-- INSERINDO DADOS NA TABELA CLIENTE
INSERT INTO CLIENTE VALUES(NULL, 'DANIEL', 'M', 'JOAO@IG.COM', '7656789254');
INSERT INTO CLIENTE VALUES(NULL, 'ISADORA', 'M', 'ISADORA@IG.COM', '987856365');
INSERT INTO CLIENTE VALUES(NULL, 'SOFIA', 'M', 'SOFIA@IG.COM', '158789887');
/* Alterando dados de uma coluna */
UPDATE CLIENTE SET SEXO = 'F'
WHERE IDCLIENTE = 3

-- INSERINDO DADOS NA TABELA ENDEREÇO
INSERT INTO ENDERECO VALUES(NULL, 'PARQUE DAS GAIVOTAS', 'SERRA', 'MANGUINHOS', 'MG', 6);


-- INSERINDO DADOS NA TABELA TELEFONE
INSERT INTO TELEFONE VALUES( NULL, 'COM', '998257545', 3);
INSERT INTO TELEFONE VALUES( NULL, 'RES', '998257545', 3);
INSERT INTO TELEFONE VALUES( NULL, 'RES', '998257545', 1);
INSERT INTO TELEFONE VALUES( NULL, 'COM', '325187865', 6);
/* PROJEÇAO -> É TUDO QUE VOCE QUER VER NA TELA */

SELECT 2 + 2 AS SOMA, NOME, NOW()
FROM CLIENTE;

/* SELEÇÃO -> É UM SUBCONJUNTO DO CONJUNTO TOTAL DE REGISTROS DE UMA TABELA
A CLÁUSULA DE SELEÇÃO É WHERE
*/

SELECT NOME, SEXO, EMAIL /* PROJECAO*/
FROM CLIENTE /* ORIGEM*/
WHERE SEXO = 'F'; /* SELECAO */

SELECT NUMERO /* PROJECAO */
FROM TELEFONE /* ORIGEM */
WHERE TIPO = 'CEL'; /* SELECAO */


/* JUNÇAO -> JOIN */

/* NOME, SEXO, BAIRRO, CIDADE */

SELECT NOME, SEXO, BAIRRO, CIDADE /* PROJECAO*/
FROM CLIENTE /* ORIGEM */
	INNER JOIN ENDERECO /* JUNCAO */
	ON IDCLIENTE = ID_CLIENTE 
WHERE NOME = 'DANIEL'; /* SELECAO*/

/* NOME, SEXO, EMAIL, TIPO, NUMERO */
SELECT NOME, SEXO, EMAIL, TIPO, NUMERO 
FROM CLIENTE
	INNER JOIN TELEFONE
	ON IDCLIENTE = ID_CLIENTE;

/* NOME, SEXO, BAIRRO, TIPO, NUMERO */

SELECT C.NOME, C.SEXO, E.BAIRRO, E.CIDADE, T.TIPO, T.NUMERO
FROM CLIENTE C
INNER JOIN ENDERECO E 
ON C.IDCLIENTE= E.ID_CLIENTE
INNER JOIN TELEFONE T
ON C.IDCLIENTE = T.ID_CLIENTE;

SELECT C.IDCLIENTE, C.NOME, C.SEXO, E.BAIRRO, T.NUMERO
FROM CLIENTE C
INNER JOIN ENDERECO E
ON C.IDCLIENTE = E.ID_CLIENTE
INNER JOIN TELEFONE T
ON C.IDCLIENTE = T.ID_CLIENTE
WHERE IDCLIENTE = 6;
